# TECHNICK√Å DOKUMENTACE
## Aplikace pro Orientaƒçn√≠ Odhad Energetick√© N√°roƒçnosti Bytu

**Verze:** 1.1.0  
**Datum:** 28. ≈ô√≠jna 2025  
**Autor:** Syst√©m pro aproximaci PENB z provozn√≠ch dat

---

## üìë OBSAH

1. [√övod a √∫ƒçel](#1-√∫vod-a-√∫ƒçel)
2. [Architektura syst√©mu](#2-architektura-syst√©mu)
3. [Datov√© modely](#3-datov√©-modely)
4. [Metodologie v√Ωpoƒçtu](#4-metodologie-v√Ωpoƒçtu)
5. [Fyzik√°ln√≠ model (RC model)](#5-fyzik√°ln√≠-model-rc-model)
6. [Kalibrace parametr≈Ø](#6-kalibrace-parametr≈Ø)
7. [Preprocessing dat](#7-preprocessing-dat)
8. [Weather API integrace](#8-weather-api-integrace)
9. [Simulace a v√Ωpoƒçet](#9-simulace-a-v√Ωpoƒçet)
10. [Klasifikace a metriky](#10-klasifikace-a-metriky)
11. [Hodnocen√≠ kvality](#11-hodnocen√≠-kvality)
12. [U≈æivatelsk√© rozhran√≠](#12-u≈æivatelsk√©-rozhran√≠)
13. [API Reference](#13-api-reference)
14. [Konfigurace](#14-konfigurace)
15. [Limitace a omezen√≠](#15-limitace-a-omezen√≠)

---

## 1. √öVOD A √öƒåEL

### 1.1 C√≠l aplikace

Aplikace poskytuje **orientaƒçn√≠ odhad energetick√© n√°roƒçnosti bytu** na z√°kladƒõ:
- Provozn√≠ch dat (mƒõ≈ôen√© spot≈ôeby energie)
- Meteorologick√Ωch dat (sta≈æen√Ωch z WeatherAPI.com)
- Geometrie bytu
- Parametr≈Ø vyt√°pƒõc√≠ho syst√©mu

**NEN√ç** n√°hradou za ofici√°ln√≠ Pr≈Økaz energetick√© n√°roƒçnosti budovy (PENB) podle vyhl√°≈°ky ƒç. 264/2020 Sb.

### 1.2 Kl√≠ƒçov√© funkce

‚úÖ **Automatick√° kalibrace** termick√©ho modelu na provozn√≠ data  
‚úÖ **T≈ôi re≈æimy** kvality v√Ωpoƒçtu (BASIC, STANDARD, ADVANCED)  
‚úÖ **Interaktivn√≠ GUI** (Streamlit)  
‚úÖ **HTML reporty** s grafick√Ωm zn√°zornƒõn√≠m  
‚úÖ **Flexibiln√≠ nastaven√≠** den/noc re≈æim≈Ø a mƒõs√≠c≈Ø bez topen√≠  
‚úÖ **Hodnocen√≠ spolehlivosti** v√Ωsledk≈Ø

### 1.3 Pou≈æit√© technologie

- **Python 3.8+**
- **Streamlit** - webov√© GUI
- **Pandas & NumPy** - zpracov√°n√≠ dat
- **SciPy** - optimalizace
- **Pydantic** - validace dat
- **WeatherAPI.com** - meteorologick√° data
- **Jinja2** - HTML reporty

---

## 2. ARCHITEKTURA SYST√âMU

### 2.1 Struktura projektu

```
PENB_energy_label_approximation/
‚îú‚îÄ‚îÄ main.py                     # Hlavn√≠ vstupn√≠ bod
‚îú‚îÄ‚îÄ requirements.txt            # Python z√°vislosti
‚îú‚îÄ‚îÄ app_gui/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ gui_main.py            # Streamlit aplikace
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ data_models.py         # Pydantic modely
‚îÇ   ‚îú‚îÄ‚îÄ config.py              # Spr√°va konfigurace
‚îÇ   ‚îú‚îÄ‚îÄ weather_api.py         # WeatherAPI integrace
‚îÇ   ‚îú‚îÄ‚îÄ preprocess.py          # ƒåi≈°tƒõn√≠ a preprocessing
‚îÇ   ‚îú‚îÄ‚îÄ baseline_split.py      # Rozdƒõlen√≠ vyt√°pƒõn√≠/TUV
‚îÇ   ‚îú‚îÄ‚îÄ rc_model.py            # Fyzik√°ln√≠ model 1R1C
‚îÇ   ‚îú‚îÄ‚îÄ calibrator.py          # Kalibrace parametr≈Ø
‚îÇ   ‚îú‚îÄ‚îÄ simulate_year.py       # Roƒçn√≠ simulace
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py             # Klasifikace a metriky
‚îÇ   ‚îî‚îÄ‚îÄ quality_flags.py       # Hodnocen√≠ kvality
‚îú‚îÄ‚îÄ reports/
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îî‚îÄ‚îÄ report_builder.py      # Gener√°tor HTML report≈Ø
‚îú‚îÄ‚îÄ storage/
‚îÇ   ‚îú‚îÄ‚îÄ token_store.json       # API kl√≠ƒçe (lok√°ln√≠)
‚îÇ   ‚îî‚îÄ‚îÄ user_inputs.json       # Posledn√≠ vstupy
‚îî‚îÄ‚îÄ tests/
    ‚îú‚îÄ‚îÄ test_imports.py
    ‚îú‚îÄ‚îÄ test_new_features.py
    ‚îî‚îÄ‚îÄ ...
```

### 2.2 Datov√Ω tok

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ U≈æivatelsk√Ω     ‚îÇ
‚îÇ vstup (GUI)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 1. VALIDACE VSTUP≈Æ              ‚îÇ
‚îÇ    (Pydantic models)            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 2. STA≈ΩEN√ç POƒåAS√ç               ‚îÇ
‚îÇ    (WeatherAPI.com)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 3. PREPROCESSING                ‚îÇ
‚îÇ    - ƒåi≈°tƒõn√≠ dat                ‚îÇ
‚îÇ    - Zarovn√°n√≠ ƒçasov√Ωch ≈ôad     ‚îÇ
‚îÇ    - Rozdƒõlen√≠ vyt√°pƒõn√≠/TUV     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 4. KALIBRACE RC MODELU          ‚îÇ
‚îÇ    - Line√°rn√≠ odhad             ‚îÇ
‚îÇ    - Optimalizace (L-BFGS-B)    ‚îÇ
‚îÇ    - nebo Differential Evolution‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 5. SIMULACE REFERENƒåN√çHO ROKU   ‚îÇ
‚îÇ    - Typick√Ω meteorologick√Ω rok ‚îÇ
‚îÇ    - Hodinov√° simulace          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 6. V√ùPOƒåET V√ùSLEDK≈Æ             ‚îÇ
‚îÇ    - Roƒçn√≠ pot≈ôeba tepla        ‚îÇ
‚îÇ    - Prim√°rn√≠ energie           ‚îÇ
‚îÇ    - Klasifikace do t≈ô√≠d A-G    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ 7. HODNOCEN√ç KVALITY            ‚îÇ
‚îÇ    - Quality score              ‚îÇ
‚îÇ    - Disclaimery                ‚îÇ
‚îÇ    - N√°vrhy zlep≈°en√≠            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ HTML Report     ‚îÇ
‚îÇ + GUI v√Ωstup    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 3. DATOV√â MODELY

### 3.1 Hlavn√≠ datov√© struktury (Pydantic)

#### 3.1.1 `ApartmentGeometry`
```python
class ApartmentGeometry(BaseModel):
    area_m2: float           # Plocha bytu [m¬≤]
    height_m: float          # V√Ω≈°ka stropu [m]
    
    @property
    def volume_m3(self) -> float:
        return self.area_m2 * self.height_m
```

#### 3.1.2 `HeatingSystemInfo`
```python
class HeatingSystemInfo(BaseModel):
    system_type: HeatingSystemType
    # Mo≈ænosti: CONDENSING_BOILER, DIRECT_ELECTRIC,
    #           HEAT_PUMP_AIR, HEAT_PUMP_WATER, UNKNOWN
    
    efficiency_or_cop: Optional[float]
    # Pro kotel: √∫ƒçinnost 0-1
    # Pro Tƒå: COP > 1
```

#### 3.1.3 `TemperatureProfile`
```python
class TemperatureProfile(BaseModel):
    day_temp_c: float = 21.0          # Denn√≠ teplota [¬∞C]
    night_temp_c: float = 19.0        # Noƒçn√≠ teplota [¬∞C]
    day_start_hour: int = 6           # Zaƒç√°tek dne [hodina 0-23]
    day_end_hour: int = 22            # Konec dne [hodina 0-23]
```

**Validace:**
- `night_temp_c` ‚â§ `day_temp_c`
- `day_end_hour` > `day_start_hour`

#### 3.1.4 `DailyEnergyData`
```python
class DailyEnergyData(BaseModel):
    date: date                        # Datum
    energy_total_kwh: float           # Celkov√° spot≈ôeba [kWh]
    note: Optional[str]               # Pozn√°mka
```

#### 3.1.5 `UserInputs` (kompletn√≠ vstup)
```python
class UserInputs(BaseModel):
    geometry: ApartmentGeometry
    heating_system: HeatingSystemInfo
    location: str                      # Mƒõsto nebo "lat,lon"
    computation_mode: ComputationMode  # BASIC/STANDARD/ADVANCED
    comfort_temperature: TemperatureProfile
    daily_energy: List[DailyEnergyData]
    avg_indoor_temp_c: Optional[float]
    non_heating_months: Optional[List[int]]  # NOV√â v 1.1.0
```

#### 3.1.6 `CalibratedParameters`
```python
class CalibratedParameters(BaseModel):
    H_env_W_per_K: float               # Tepeln√© ztr√°ty ob√°lkou [W/K]
    infiltration_rate_per_h: float     # Intenzita infiltrace [1/h]
    C_th_J_per_K: float                # Tepeln√° kapacita [J/K]
    baseline_TUV_kwh_per_day: float    # Baseline TUV [kWh/den]
    internal_gains_W_per_m2: float     # Intern√≠ zisky [W/m¬≤]
    
    # Kvalita kalibrace
    rmse_temperature_c: float          # RMSE vnit≈ôn√≠ teploty [¬∞C]
    mape_energy_pct: float             # MAPE denn√≠ energie [%]
```

#### 3.1.7 `AnnualResults`
```python
class AnnualResults(BaseModel):
    heating_demand_kwh_per_m2_year: float    # Mƒõrn√° pot≈ôeba tepla
    primary_energy_kwh_per_m2_year: float    # Prim√°rn√≠ energie
    energy_class: EnergyClass                # T≈ô√≠da A-G
    quality_level: QualityLevel              # LOW/MEDIUM/HIGH
    
    # Interval spolehlivosti
    heating_demand_lower_bound: Optional[float]
    heating_demand_upper_bound: Optional[float]
    
    disclaimers: List[str]
    computation_date: datetime
```

### 3.2 Enumerace

```python
class ComputationMode(str, Enum):
    BASIC = "basic"        # Min. 1 den, hrub√Ω odhad
    STANDARD = "standard"  # Min. 7 dn√≠, 1R1C kalibrace
    ADVANCED = "advanced"  # Min. 28 dn√≠, glob√°ln√≠ optimalizace

class QualityLevel(str, Enum):
    LOW = "low"
    MEDIUM = "medium"
    HIGH = "high"

class EnergyClass(str, Enum):
    A = "A"  # Nejlep≈°√≠
    B = "B"
    C = "C"
    D = "D"
    E = "E"
    F = "F"
    G = "G"  # Nejhor≈°√≠
```

---

## 4. METODOLOGIE V√ùPOƒåTU

### 4.1 P≈ôehled re≈æim≈Ø v√Ωpoƒçtu

| Re≈æim | Min. data | Metoda | P≈ôesnost | Rychlost |
|-------|-----------|--------|----------|----------|
| **BASIC** | 1 den | Line√°rn√≠ regrese | ‚≠ê‚≠ê | ‚ö°‚ö°‚ö° |
| **STANDARD** | 7 dn√≠ | 1R1C + L-BFGS-B | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚ö°‚ö° |
| **ADVANCED** | 28 dn√≠ | 1R1C + Diff. Evolution | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | ‚ö° |

### 4.2 F√°ze v√Ωpoƒçtu

#### F√°ze 1: Z√≠sk√°n√≠ dat
1. **Validace vstup≈Ø** (Pydantic)
2. **Sta≈æen√≠ poƒças√≠** (WeatherAPI.com)
3. **ƒåi≈°tƒõn√≠ dat** (interpolace kr√°tk√Ωch mezer, detekce outlier≈Ø)

#### F√°ze 2: Preprocessing
1. **Zarovn√°n√≠** ƒçasov√Ωch ≈ôad (denn√≠ ‚Üî hodinov√°)
2. **Rozdƒõlen√≠** spot≈ôeby na vyt√°pƒõn√≠ vs. TUV
3. **Vytvo≈ôen√≠** hodinov√©ho teplotn√≠ho profilu

#### F√°ze 3: Kalibrace
1. **Poƒç√°teƒçn√≠ odhad** parametr≈Ø (line√°rn√≠ regrese)
2. **Optimalizace** parametr≈Ø RC modelu
3. **Validace** kvality kalibrace (RMSE, MAPE)

#### F√°ze 4: Simulace
1. **Vytvo≈ôen√≠** typick√©ho meteorologick√©ho roku
2. **Hodinov√° simulace** s kalibrovan√Ωm modelem
3. **Agregace** na roƒçn√≠ pot≈ôebu tepla

#### F√°ze 5: V√Ωsledky
1. **V√Ωpoƒçet** prim√°rn√≠ energie
2. **Klasifikace** do energetick√Ωch t≈ô√≠d
3. **Hodnocen√≠** spolehlivosti
4. **Generov√°n√≠** reportu

---

## 5. FYZIK√ÅLN√ç MODEL (RC MODEL)

### 5.1 Teorie 1R1C modelu

**Koncept:**  
Budova je reprezentov√°na jako **jeden tepeln√Ω uzel** s:
- **1 tepeln√Ωm odporem (R)** ‚Üí tepeln√© ztr√°ty ob√°lkou
- **1 tepelnou kapacitou (C)** ‚Üí tepeln√° setrvaƒçnost

**Diferenci√°ln√≠ rovnice:**

$$
C_{th} \frac{dT_{in}}{dt} = Q_{heat} + Q_{solar} + Q_{internal} - H_{total} \cdot (T_{in} - T_{out})
$$

Kde:
- $C_{th}$ [J/K] = tepeln√° kapacita budovy
- $T_{in}$ [¬∞C] = vnit≈ôn√≠ teplota
- $T_{out}$ [¬∞C] = venkovn√≠ teplota
- $Q_{heat}$ [W] = dodan√© teplo z topen√≠
- $Q_{solar}$ [W] = sluneƒçn√≠ zisky
- $Q_{internal}$ [W] = intern√≠ zisky (lid√©, spot≈ôebiƒçe)
- $H_{total}$ [W/K] = celkov√© tepeln√© ztr√°ty

### 5.2 Komponenty $H_{total}$

$$
H_{total} = H_{env} + H_{vent}
$$

**1. Tepeln√© ztr√°ty ob√°lkou:**
$$
H_{env} = \sum (U_i \cdot A_i)
$$
- $U_i$ [W/(m¬≤¬∑K)] = souƒçinitel prostupu tepla
- $A_i$ [m¬≤] = plocha konstrukce

**2. Vƒõtrac√≠ ztr√°ty:**
$$
H_{vent} = \rho_{air} \cdot c_p \cdot n \cdot V / 3600
$$
- $\rho_{air}$ = 1.2 kg/m¬≥ (hustota vzduchu)
- $c_p$ = 1005 J/(kg¬∑K) (mƒõrn√© teplo vzduchu)
- $n$ [1/h] = intenzita infiltrace
- $V$ [m¬≥] = objem bytu

### 5.3 Tepeln√© zisky

**Sluneƒçn√≠ zisky:**
$$
Q_{solar} = GHI \cdot A_{floor} \cdot \alpha_{solar}
$$
- $GHI$ [W/m¬≤] = glob√°ln√≠ sluneƒçn√≠ z√°≈ôen√≠
- $A_{floor}$ [m¬≤] = plocha bytu
- $\alpha_{solar}$ = 0.02 (efektivn√≠ apertura pro byty, typicky mal√°)

**Intern√≠ zisky:**
$$
Q_{internal} = q_{int} \cdot A_{floor}
$$
- $q_{int}$ = 3 W/m¬≤ (typick√° hodnota pro byty)

### 5.4 Numerick√° integrace (Euler forward)

Pro ƒçasov√Ω krok $\Delta t$ = 3600 s (1 hodina):

$$
T_{in}(t + \Delta t) = T_{in}(t) + \frac{dT_{in}}{dt} \cdot \Delta t
$$

$$
\frac{dT_{in}}{dt} = \frac{Q_{in} - Q_{out}}{C_{th}}
$$

### 5.5 Odhad pot≈ôebn√©ho v√Ωkonu

V **ust√°len√©m stavu** ($dT_{in}/dt = 0$):

$$
Q_{heat} = H_{total} \cdot (T_{setpoint} - T_{out}) - Q_{solar} - Q_{internal}
$$

Pokud $Q_{heat} < 0$ ‚Üí **nen√≠ pot≈ôeba topit** (nebo by bylo pot≈ôeba chladit).

---

## 6. KALIBRACE PARAMETR≈Æ

### 6.1 Metody kalibrace podle re≈æimu

#### 6.1.1 BASIC re≈æim
**Metoda:** Line√°rn√≠ regrese  
**Vstup:** Denn√≠ spot≈ôeby + pr≈Ømƒõrn√© venkovn√≠ teploty  
**Model:**
$$
E_{heating,daily} = a \cdot \Delta T + b
$$

Kde:
- $a \approx 24 \cdot H_{total} / 1000$ [kWh/(K¬∑den)]
- $\Delta T = T_{in,avg} - T_{out,avg}$

**V√Ωstup:**
- Hrub√Ω odhad $H_{total}$
- P≈ôedpokl√°dan√° infiltrace $n = 0.3$ 1/h
- Tepeln√° kapacita $C_{th} = 50 \cdot V$ Wh/K/m¬≥

**V√Ωhody:** Velmi rychl√©, nevy≈æaduje hodinov√° data  
**Nev√Ωhody:** N√≠zk√° p≈ôesnost, ≈æ√°dn√° dynamick√° simulace

#### 6.1.2 STANDARD re≈æim
**Metoda:** L-BFGS-B lok√°ln√≠ optimalizace  
**Vstup:** Hodinov√° data (weather + distributed energy)

**Optimalizovan√© parametry:**
```python
params = [H_env, n, log(C_th), q_int]
```

**Cost funkce:**
$$
\text{cost} = 10 \cdot \text{RMSE}_{temp} + \text{MAPE}_{energy}
$$

- $\text{RMSE}_{temp}$ = RMS chyba vnit≈ôn√≠ teploty [¬∞C]
- $\text{MAPE}_{energy}$ = st≈ôedn√≠ absolutn√≠ procentn√≠ chyba energie [%]

**Bounds:**
- $H_{env}$: 10 - 1000 W/K
- $n$: 0.05 - 2.0 1/h
- $\log(C_{th})$: $\ln(10^5)$ - $\ln(10^8)$ (‚Üí $C_{th}$: 100 kJ/K - 100 MJ/K)
- $q_{int}$: 0 - 10 W/m¬≤

**Algoritmus:** SciPy `minimize(..., method='L-BFGS-B')`

**V√Ωhody:** Dobr√° rovnov√°ha rychlost/p≈ôesnost  
**Nev√Ωhody:** M≈Ø≈æe uv√°znout v lok√°ln√≠m minimu

#### 6.1.3 ADVANCED re≈æim
**Metoda:** Differential Evolution (glob√°ln√≠ optimalizace)  
**Vstup:** Stejn√Ω jako STANDARD

**Algoritmus:** SciPy `differential_evolution(...)`
```python
de_kwargs = dict(
    bounds=bounds,
    maxiter=100,
    popsize=10,
    seed=42,
    workers=ThreadPoolExecutor(max_workers=cpu_count-1)
)
```

**V√Ωhody:** Najde glob√°ln√≠ minimum, robustnƒõj≈°√≠  
**Nev√Ωhody:** Pomalej≈°√≠ (paralelizace pom√°h√°)

### 6.2 Metriky kvality kalibrace

**RMSE teploty:**
$$
\text{RMSE}_{temp} = \sqrt{\frac{1}{N} \sum_{i=1}^{N} (T_{in,sim}^i - T_{in,obs}^i)^2}
$$

**MAPE energie:**
$$
\text{MAPE}_{energy} = \frac{100}{M} \sum_{j=1}^{M} \left| \frac{E_{obs}^j - E_{sim}^j}{E_{obs}^j + \epsilon} \right|
$$

**Interpretace:**
- RMSE < 0.5¬∞C ‚Üí **v√Ωborn√°** kalibrace
- RMSE < 1.0¬∞C ‚Üí **dobr√°** kalibrace
- RMSE < 2.0¬∞C ‚Üí **p≈ôijateln√°** kalibrace
- MAPE < 5% ‚Üí **v√Ωborn√°** kalibrace
- MAPE < 10% ‚Üí **dobr√°** kalibrace
- MAPE < 20% ‚Üí **p≈ôijateln√°** kalibrace

---

## 7. PREPROCESSING DAT

### 7.1 ƒåi≈°tƒõn√≠ meteorologick√Ωch dat

**Funkce:** `clean_weather_data(df)`

**Kroky:**
1. **Kontrola ƒçasov√Ωch raz√≠tek** ‚Üí p≈ôevod na datetime
2. **Odstranƒõn√≠ duplik√°t≈Ø** podle timestamp
3. **Detekce mezer** v ƒçasov√© ≈ôadƒõ
4. **Interpolace kr√°tk√Ωch mezer** (max 3 hodiny)
   - Metoda: line√°rn√≠ interpolace
   - `limit=3, limit_area='inside'`
5. **Oznaƒçen√≠ dlouh√Ωch mezer** (>3h) ‚Üí **neinterpolovat!**
6. **Odstranƒõn√≠ ≈ô√°dk≈Ø** s NaN (dlouh√© mezery)
7. **Kontrola rozsahu hodnot**
   - Teplota: -40¬∞C a≈æ +50¬∞C
   - Vlhkost: 0-100%

**KRITICK√â:**  
Nesm√≠ interpolovat mezi oddƒõlen√Ωmi mƒõs√≠ci! Data z ƒçervna a srpna NESM√ç b√Ωt spojov√°na interpolac√≠.

### 7.2 Baseline TUV (tepl√° u≈æitkov√° voda)

**Funkce:** `split_heating_and_tuv(daily_df, baseline_tuv_kwh=None)`

**Strategie:**

#### A) Automatick√Ω odhad (default)
```python
baseline_tuv = np.percentile(energy_total_kwh, 10)
```
- **P≈ôedpoklad:** 10% nejni≈æ≈°√≠ch spot≈ôeb = dny bez topen√≠ (jen TUV)
- **Sanity check:** baseline < 50% pr≈Ømƒõru

#### B) Z mƒõs√≠c≈Ø bez topen√≠ (NOV√â v 1.1.0)
```python
if non_heating_months:  # nap≈ô. [5,6,7,8,9]
    summer_mask = (df['month'].isin(non_heating_months)) & (df['year'] == 2025)
    baseline_tuv = df.loc[summer_mask, 'energy_total_kwh'].mean()
```
- **V√Ωhoda:** P≈ôesnƒõj≈°√≠ (v√≠ce dat, explicitn√≠ v√Ωbƒõr)
- **Stabilnƒõj≈°√≠** ne≈æ percentil

#### C) Manu√°ln√≠ pod√≠l
```python
baseline_tuv = energy_total * (tuv_percentage / 100)
```

**Rozdƒõlen√≠:**
$$
E_{heating} = \max(E_{total} - E_{TUV,baseline}, 0)
$$

### 7.3 Distribuce denn√≠ energie na hodiny

**Funkce:** `distribute_daily_heating_to_hours(...)`

**Metoda:** Proporcion√°ln√≠ podle tepeln√© pot≈ôeby

Pro ka≈æd√Ω den:
1. Vypoƒçti $\Delta T_i = \max(T_{in} - T_{out,i}, 0)$ pro ka≈ædou hodinu $i$
2. Celkov√° denn√≠ pot≈ôeba: $\sum_i \Delta T_i$
3. Pod√≠l hodiny: $w_i = \Delta T_i / \sum_i \Delta T_i$
4. Energie hodiny: $E_i = w_i \cdot E_{day,total}$

**Ovƒõ≈ôen√≠:** $\sum_i E_i = E_{day,total}$ (rekonstrukce mus√≠ sedƒõt)

### 7.4 Hodinov√Ω teplotn√≠ profil

**Funkce:** `create_hourly_indoor_temp(...)`

**Verze 1.1.0 - Flexibiln√≠ den/noc:**

```python
def create_hourly_indoor_temp(
    daily_avg_temp: Optional[float],
    hourly_weather_df: pd.DataFrame,
    day_temp: Optional[float] = None,
    night_temp: Optional[float] = None,
    day_start_hour: int = 6,
    day_end_hour: int = 22,
    day_night_delta: float = 0.5
):
    """
    Vytvo≈ô√≠ hodinov√Ω teplotn√≠ profil.
    
    PRAVIDLA PRECEDENCE:
    1. Pokud jsou day_temp a night_temp zad√°ny ‚Üí pou≈æij√≠ se (PRIORITA)
    2. Jinak pokud je zad√°na daily_avg_temp ‚Üí odvozen√≠ day/night = avg ¬± delta
    3. Jinak ‚Üí fallback na konstantn√≠ profil (daily_avg_temp)
    
    Validace: night_temp ‚â§ day_temp
    """
    for hour in hours:
        if day_start_hour <= hour < day_end_hour:
            T_in[hour] = day_temp
        else:
            T_in[hour] = night_temp
```

**Pravidla precedence (GUI verze 1.1.0):**

V GUI u≈æivatel vol√≠ jeden ze dvou re≈æim≈Ø:

**Re≈æim A: "Den/Noc re≈æim"** (doporuƒçeno pro p≈ôesnost)
- Zad√° denn√≠ teplotu (nap≈ô. 21¬∞C)
- Zad√° noƒçn√≠ teplotu (nap≈ô. 19¬∞C)  
- Zad√° ƒçasov√© rozsahy (nap≈ô. den 6:00-22:00)
- Pr≈Ømƒõrn√° teplota se **automaticky vypoƒç√≠t√°** v√°≈æen√≠m podle hodin
- Tento re≈æim m√° **PRIORITU** p≈ôi v√Ωpoƒçtu

**Re≈æim B: "Pr≈Ømƒõrn√° teplota"** (jednodu≈°≈°√≠, m√©nƒõ p≈ôesn√©)
- Zad√° pouze jednu hodnotu (nap≈ô. 21¬∞C)
- Pou≈æije se **konstantn√≠** teplotn√≠ profil (den = noc = pr≈Ømƒõr)
- Vhodn√© pro rychl√Ω odhad nebo pokud nen√≠ zn√°m√Ω teplotn√≠ re≈æim

**GUI implementace:**
- Radio button v TAB 2 "Byt & Syst√©m" pro v√Ωbƒõr re≈æimu
- Dynamick√© zobrazen√≠ vstupn√≠ch pol√≠ podle zvolen√©ho re≈æimu
- Validace: night_temp ‚â§ day_temp, day_end_hour > day_start_hour
- Info tooltip s vypoƒç√≠tanou pr≈Ømƒõrnou teplotou v re≈æimu A

**Star≈°√≠ verze (fallback):**  
Sinusoidn√≠ variace kolem pr≈Ømƒõru:
$$
T_{in}(h) = T_{avg} + \Delta T \cdot \sin\left(2\pi \frac{h - 2}{24}\right)
$$

---

## 8. WEATHER API INTEGRACE

### 8.1 WeatherAPI.com

**Endpoint:** `http://api.weatherapi.com/v1/`

**Podporovan√© API:**
1. **forecast.json** - p≈ôedpovƒõƒè + ned√°vn√° historie (free tier: 7 dn√≠)
2. **history.json** - historick√° data (placen√Ω tarif)
3. **current.json** - aktu√°ln√≠ poƒças√≠

### 8.2 Strategie stahov√°n√≠

**Funkce:** `fetch_hourly_weather(location, start_date, end_date, api_key)`

**T≈ô√≠stup≈àov√° strategie:**

```python
for date in date_range:
    # Krok 1: Zkus forecast API (free tier)
    if days_back <= 7:
        try:
            data = fetch_forecast(date)
            success = True
        except:
            pass
    
    # Krok 2: Zkus history API (placen√Ω)
    if not success:
        try:
            data = fetch_history(date)
            success = True
        except HTTP_400:  # Free tier limitation
            pass
    
    # Krok 3: Fallback - syntetick√° data
    if not success:
        data = generate_synthetic(date)
```

**Syntetick√° data:**
- Teplotn√≠ sinusoida podle mƒõs√≠ce
- GHI podle denn√≠ doby
- Konstantn√≠ vlhkost a v√≠tr

### 8.3 Typick√Ω meteorologick√Ω rok (TMY)

**Funkce:** `create_typical_year_weather(location, api_key)`

**MVP implementace:**  
Sinusoidn√≠ aproximace (8760 hodin):

$$
T(d, h) = T_{avg} + 10 \cdot \sin\left(2\pi \frac{d - 80}{365}\right) + 3 \cdot \sin\left(2\pi \frac{h - 6}{24}\right)
$$

- $d$ = den v roce (1-365)
- $h$ = hodina dne (0-23)
- $T_{avg}$ = pr≈Ømƒõrn√° roƒçn√≠ teplota (detekov√°na z aktu√°ln√≠ho poƒças√≠)

**Sluneƒçn√≠ z√°≈ôen√≠:**
$$
GHI(d, h) = 500 \cdot \sin\left(\pi \frac{h - 6}{12}\right) \cdot \left(1 + 0.5 \sin\left(2\pi \frac{d}{365}\right)\right)
$$
- Pouze 6:00-18:00
- Maximum v l√©tƒõ, minimum v zimƒõ

**Produkƒçn√≠ verze (TODO):**  
Pou≈æ√≠t skuteƒçn√° TMY data (nap≈ô. PVGIS, Meteonorm)

### 8.4 Detekce lokace

**Funkce:** `detect_location()`

**Metoda:** IP geolokace pomoc√≠ `geocoder` library

```python
g = geocoder.ip('me')
city = g.city
lat, lng = g.lat, g.lng
```

**Fallback:** Praha (50.0755, 14.4378)

---

## 9. SIMULACE A V√ùPOƒåET

### 9.1 Roƒçn√≠ simulace

**Funkce:** `simulate_annual_heating_demand(...)`

**Vstup:**
- Kalibrovan√© parametry
- Typick√Ω meteorologick√Ω rok (8760 hodin)
- Geometrie bytu
- Komfortn√≠ teplotn√≠ profil

**Proces:**

```python
model = RC1Model(calibrated_params)

for hour in tmy_year:
    # Urƒçi setpoint podle hodiny
    T_setpoint = comfort_profile.get_temp(hour.hour)
    
    # Vypoƒçti pot≈ôebn√© teplo
    Q_heat = model.estimate_heating_demand(
        T_setpoint,
        hour.temp_out,
        hour.ghi
    )
    
    annual_demand[hour] = Q_heat
```

**V√Ωstup:**
- Hodinov√° pot≈ôeba topn√©ho v√Ωkonu [W]
- Agregace na roƒçn√≠ energii [kWh]
- Mƒõrn√° pot≈ôeba [kWh/(m¬≤¬∑rok)]

### 9.2 Prim√°rn√≠ energie

**Funkce:** `calculate_primary_energy(...)`

**Vzorce:**

$$
E_{primary} = \frac{E_{heating}}{\eta_{system}} \cdot f_{PE}
$$

Kde:
- $\eta_{system}$ = √∫ƒçinnost (kotel) nebo 1/COP (Tƒå)
- $f_{PE}$ = faktor prim√°rn√≠ energie

**Faktory prim√°rn√≠ energie (ƒåR orientaƒçnƒõ):**
- Elekt≈ôina: $f_{PE}$ = 3.0
- Zemn√≠ plyn: $f_{PE}$ = 1.1

**P≈ô√≠klady:**

**1. Kondenzaƒçn√≠ kotel (Œ∑ = 0.92):**
$$
E_{plyn} = \frac{E_{heating}}{0.92}
$$
$$
E_{primary} = E_{plyn} \cdot 1.1
$$

**2. Tepeln√© ƒçerpadlo (COP = 3.2):**
$$
E_{el} = \frac{E_{heating}}{3.2}
$$
$$
E_{primary} = E_{el} \cdot 3.0
$$

**3. P≈ô√≠motop (Œ∑ = 1.0):**
$$
E_{primary} = E_{heating} \cdot 3.0
$$

### 9.3 Interval spolehlivosti

**Funkce:** `estimate_uncertainty_bounds(...)`

**Metoda:** Empirick√Ω odhad podle kvality kalibrace

$$
\text{uncertainty} = \frac{\text{MAPE}_{energy}}{100} + 0.05 \cdot N_{warnings}
$$

$$
E_{lower} = E_{heating} \cdot (1 - \text{uncertainty})
$$
$$
E_{upper} = E_{heating} \cdot (1 + \text{uncertainty})
$$

**Max uncertainty:** 50%

**Interpretace:**
- MAPE 5%, 0 varov√°n√≠ ‚Üí ¬±5% interval
- MAPE 15%, 3 varov√°n√≠ ‚Üí ¬±30% interval

---

## 10. KLASIFIKACE A METRIKY

### 10.1 Energetick√© t≈ô√≠dy

**Funkce:** `classify_energy_label(...)`

**Hranice (orientaƒçn√≠, zjednodu≈°en√©):**

#### Podle prim√°rn√≠ energie [kWh/(m¬≤¬∑rok)]:

| T≈ô√≠da | Rozsah | Popis |
|-------|--------|-------|
| **A** | < 50 | Mimo≈ô√°dnƒõ √∫sporn√° (pasivn√≠ domy) |
| **B** | 50-75 | Velmi √∫sporn√° (n√≠zkoenergetick√©) |
| **C** | 75-110 | √ösporn√° (modern√≠ budovy) |
| **D** | 110-150 | M√©nƒõ √∫sporn√° (pr≈Ømƒõr nov√© v√Ωstavby) |
| **E** | 150-200 | Nehospod√°rn√° |
| **F** | 200-270 | Velmi nehospod√°rn√° |
| **G** | > 270 | Mimo≈ô√°dnƒõ nehospod√°rn√° (panelov√© domy) |

**POZN√ÅMKA:**  
Skuteƒçn√Ω PENB pou≈æ√≠v√° slo≈æitƒõj≈°√≠ metodiku podle TNI 73 0329/Z1.  
Tyto hranice jsou **pouze orientaƒçn√≠** pro √∫ƒçely t√©to aplikace!

### 10.2 Barvy t≈ô√≠d

```python
colors = {
    'A': "#00A651",  # tmavƒõ zelen√°
    'B': "#4AB849",  # zelen√°
    'C': "#C5D82F",  # ≈ælutozelen√°
    'D': "#FFF200",  # ≈ælut√°
    'E': "#FDB913",  # oran≈æov√°
    'F': "#F37021",  # tmavƒõ oran≈æov√°
    'G': "#ED1C24"   # ƒçerven√°
}
```

### 10.3 Popisky t≈ô√≠d

| T≈ô√≠da | Popis |
|-------|-------|
| A | Mimo≈ô√°dnƒõ √∫sporn√° |
| B | Velmi √∫sporn√° |
| C | √ösporn√° |
| D | M√©nƒõ √∫sporn√° |
| E | Nehospod√°rn√° |
| F | Velmi nehospod√°rn√° |
| G | Mimo≈ô√°dnƒõ nehospod√°rn√° |

---

## 11. HODNOCEN√ç KVALITY

### 11.1 Quality Score syst√©m

**Funkce:** `assess_quality_level(...)`

**Sk√≥re (0-100):**

```python
score = 0

# 1. Re≈æim v√Ωpoƒçtu
score += {ADVANCED: 30, STANDARD: 20, BASIC: 5}

# 2. D√©lka dat
if n_days >= 28:  score += 30
elif n_days >= 14: score += 20
elif n_days >= 7:  score += 10
else:              score += 2

# 3. RMSE teploty
if RMSE < 0.5:  score += 20
elif RMSE < 1.0: score += 15
elif RMSE < 2.0: score += 10
else:            score += 2

# 4. MAPE energie
if MAPE < 5:   score += 20
elif MAPE < 10: score += 15
elif MAPE < 20: score += 10
else:           score += 2

# 5. Penalizace za varov√°n√≠
score -= len(warnings) * 5
```

**Klasifikace:**
- score ‚â• 70 ‚Üí **HIGH** quality
- score ‚â• 40 ‚Üí **MEDIUM** quality
- score < 40 ‚Üí **LOW** quality

### 11.2 Disclaimery

**Funkce:** `generate_disclaimers(...)`

**V≈ædy:**
- "Toto NEN√ç ofici√°ln√≠ PENB"
- Upozornƒõn√≠ podle quality level

**Podm√≠nƒõn√©:**
- Re≈æim BASIC ‚Üí "Pouze hrub√Ω odhad"
- M√°lo dat ‚Üí "Doporuƒçeno v√≠ce dat"
- Varov√°n√≠ v datech ‚Üí "Zji≈°tƒõny probl√©my"

### 11.3 N√°vrhy zlep≈°en√≠

**Funkce:** `suggest_improvements(...)`

**Kategorie n√°vrh≈Ø:**

1. **V√Ωpoƒçetn√≠ re≈æim:**
   - BASIC ‚Üí "Pou≈æijte STANDARD/ADVANCED"

2. **Mno≈æstv√≠ dat:**
   - < 28 dn√≠ ‚Üí "Dopl≈àte v√≠ce dat"

3. **Kalibrace:**
   - RMSE > 2¬∞C ‚Üí "Zkontrolujte vnit≈ôn√≠ teploty"
   - MAPE > 20% ‚Üí "Zkontrolujte odeƒçty spot≈ôeby"

4. **Fyzik√°ln√≠ parametry:**
   - n > 0.8 ‚Üí "Vysok√° infiltrace, zva≈æte v√Ωmƒõnu oken"
   - H_env > 200 ‚Üí "Vysok√© ztr√°ty, zva≈æte zateplen√≠"

5. **√öspƒõch:**
   - HIGH quality ‚Üí "Pro ofici√°ln√≠ PENB kontaktujte odborn√≠ka"

---

## 12. U≈ΩIVATELSK√â ROZHRAN√ç

### 12.1 Streamlit GUI

**Soubor:** `app_gui/gui_main.py`

**Struktura:** 5 z√°lo≈æek (tabs)

#### TAB 1: Lokalita üìç
```python
- Auto-detekce lokace (IP geolokace)
- Ruƒçn√≠ zad√°n√≠ (mƒõsto nebo "lat,lon")
- Ulo≈æen√≠ posledn√≠ lokace
```

#### TAB 2: Byt & Syst√©m üè†
```python
# Geometrie
- Plocha [m¬≤]: number_input(10-500)
- V√Ω≈°ka stropu [m]: number_input(2.0-5.0)
- ‚Üí Automatick√Ω v√Ωpoƒçet objemu

# Vnit≈ôn√≠ teplota (NOV√â v 1.1.0)
- Re≈æim: radio("Den/Noc re≈æim", "Pr≈Ømƒõrn√° teplota")

## Pokud "Den/Noc re≈æim":
- Denn√≠ teplota [¬∞C]: slider(18-24)
- Noƒçn√≠ teplota [¬∞C]: slider(16-24)
- Den zaƒç√≠n√° [h]: number_input(0-23)
- Den konƒç√≠ [h]: number_input(0-23)
- Info: Vypoƒç√≠tan√° pr≈Ømƒõrn√° teplota

## Pokud "Pr≈Ømƒõrn√° teplota":
- Pr≈Ømƒõrn√° vnit≈ôn√≠ teplota [¬∞C]: slider(16-26)
- Info: Pou≈æije se konstantn√≠ profil

# Syst√©m vyt√°pƒõn√≠
- Typ: selectbox(CONDENSING_BOILER, HEAT_PUMP_AIR, ...)
- √öƒçinnost/COP: number_input (voliteln√©)
```

#### TAB 3: Data üìä
```python
# Denn√≠ spot≈ôeby
- Nahr√°t CSV: file_uploader
- nebo Zadat ruƒçnƒõ: data_editor

# Mƒõs√≠ce bez topen√≠ (NOV√â v 1.1.0)
- Multiselect: [Leden, √önor, ..., Prosinec]
- Default: [Kvƒõten, ƒåerven, ƒåervenec, Srpen, Z√°≈ô√≠]

# TUV aproximace
- Pou≈æ√≠t model: checkbox(True)
- nebo Manu√°ln√≠ pod√≠l [%]: slider(0-100)
```

**Pozn√°mka:** Pr≈Ømƒõrn√° vnit≈ôn√≠ teplota byla p≈ôesunuta do TAB 2 (verze 1.1.0).

#### TAB 4: V√Ωpoƒçet ‚öôÔ∏è
```python
# Kontrola p≈ôed v√Ωpoƒçtem
- API kl√≠ƒç OK?
- Lokalita zad√°na?
- Dostatek dat?

# Spu≈°tƒõn√≠
- Button "SPUSTIT V√ùPOƒåET"
- Progress bar (0-100%)
- Status text (ka≈æd√° f√°ze)
```

#### TAB 5: V√Ωsledky üéâ
```python
# Energetick√° t≈ô√≠da
- Velk√Ω barevn√Ω banner (t≈ô√≠da A-G)
- Popis t≈ô√≠dy

# Metriky (4 sloupce)
- Mƒõrn√° pot≈ôeba tepla
- Prim√°rn√≠ energie
- Spolehlivost (badge)
- MAPE kalibrace

# Grafy (TODO)

# Upozornƒõn√≠ a doporuƒçen√≠
- Disclaimery (warning boxes)
- Suggestions (info boxes)

# Export
- Generovat HTML report
- Download button
```

### 12.2 Sidebar nastaven√≠

```python
# API kl√≠ƒç
- text_input(type="password")
- Auto-ulo≈æen√≠

# Re≈æim v√Ωpoƒçtu
- selectbox: BASIC / STANDARD / ADVANCED
- Info o re≈æimu
```

### 12.3 Session state

```python
st.session_state['location']            # str
st.session_state['daily_energy_data']   # List[DailyEnergyData]

# Teplotn√≠ re≈æim (NOV√â v 1.1.0)
st.session_state['temp_mode']           # 'day_night' | 'average'
# Pokud 'day_night':
st.session_state['temp_day']            # float
st.session_state['temp_night']          # float
st.session_state['day_start_hour']      # int
st.session_state['day_end_hour']        # int
# Pokud 'average':
st.session_state['temp_avg']            # float

st.session_state['non_heating_months']  # List[int]
st.session_state['tuv_percentage']      # Optional[int]
st.session_state['use_tuv_model']       # bool
st.session_state['results']             # dict
```

---

## 13. API REFERENCE

### 13.1 Core moduly

#### `rc_model.py`

**class RC1Model:**
```python
def __init__(
    H_env_W_per_K: float,
    infiltration_rate_per_h: float,
    volume_m3: float,
    C_th_J_per_K: float,
    area_m2: float,
    internal_gains_W_per_m2: float = 3.0,
    solar_aperture: float = 0.02
)

def simulate_step(
    T_in_prev: float,
    T_out: float,
    Q_heat_W: float,
    GHI_W_per_m2: float,
    dt_seconds: float = 3600
) -> float

def simulate_hourly(
    T_in_initial: float,
    hourly_df: pd.DataFrame,
    Q_heat_column: str = 'heating_power_W'
) -> pd.DataFrame

def estimate_heating_demand(
    T_in_setpoint: float,
    T_out: float,
    GHI_W_per_m2: float = 0
) -> float
```

**Funkce:**
```python
def estimate_initial_parameters(
    daily_energy_df: pd.DataFrame,
    hourly_weather_df: pd.DataFrame,
    volume_m3: float,
    avg_indoor_temp: float
) -> Tuple[float, float, float]
```

#### `calibrator.py`

```python
def calibrate_model_simple(
    daily_energy_df: pd.DataFrame,
    hourly_weather_df: pd.DataFrame,
    geometry_volume_m3: float,
    geometry_area_m2: float,
    avg_indoor_temp: float,
    baseline_tuv_kwh: float,
    mode: str = "standard"  # "basic" | "standard" | "advanced"
) -> CalibratedParameters
```

#### `preprocess.py`

```python
def clean_weather_data(
    df: pd.DataFrame
) -> pd.DataFrame

def align_daily_energy_to_hourly(
    daily_energy_df: pd.DataFrame,
    hourly_weather_df: pd.DataFrame
) -> Tuple[pd.DataFrame, pd.DataFrame]

def create_hourly_indoor_temp(
    daily_avg_temp: float,
    hourly_weather_df: pd.DataFrame,
    day_temp: Optional[float] = None,
    night_temp: Optional[float] = None,
    day_start_hour: int = 6,
    day_end_hour: int = 22,
    day_night_delta: float = 0.5
) -> pd.DataFrame

def validate_data_quality(
    daily_energy_df: pd.DataFrame,
    hourly_df: pd.DataFrame
) -> List[str]
```

#### `baseline_split.py`

```python
def estimate_baseline_tuv(
    daily_energy_df: pd.DataFrame,
    percentile: float = 10.0
) -> float

def split_heating_and_tuv(
    daily_energy_df: pd.DataFrame,
    baseline_tuv_kwh: Optional[float] = None
) -> pd.DataFrame

def distribute_daily_heating_to_hours(
    daily_heating_df: pd.DataFrame,
    hourly_weather_df: pd.DataFrame,
    indoor_temp_c: float = 21.0
) -> pd.DataFrame
```

#### `weather_api.py`

```python
def detect_location() -> Tuple[str, float, float]

def fetch_hourly_weather(
    location: str,
    start_date: date,
    end_date: date,
    api_key: str
) -> pd.DataFrame

def create_typical_year_weather(
    location: str,
    api_key: str
) -> pd.DataFrame
```

#### `simulate_year.py`

```python
def simulate_annual_heating_demand(
    calibrated_params: CalibratedParameters,
    typical_year_weather: pd.DataFrame,
    geometry_volume_m3: float,
    geometry_area_m2: float,
    comfort_profile: TemperatureProfile
) -> pd.DataFrame

def calculate_primary_energy(
    heating_demand_kwh_per_year: float,
    system_type: str,
    efficiency_or_cop: float,
    primary_energy_factors: dict = None
) -> float

def estimate_uncertainty_bounds(
    calibrated_params: CalibratedParameters,
    heating_demand_kwh_per_m2: float,
    data_quality_warnings: list
) -> tuple[float, float]
```

#### `metrics.py`

```python
def classify_energy_label(
    heating_demand_kwh_per_m2_year: float,
    primary_energy_kwh_per_m2_year: float,
    use_primary: bool = True
) -> EnergyClass

def get_class_description(energy_class: EnergyClass) -> str
def get_class_color(energy_class: EnergyClass) -> str
```

#### `quality_flags.py`

```python
def assess_quality_level(
    computation_mode: ComputationMode,
    n_days_data: int,
    calibrated_params: CalibratedParameters,
    data_warnings: list
) -> QualityLevel

def generate_disclaimers(
    quality_level: QualityLevel,
    computation_mode: ComputationMode,
    n_days_data: int,
    data_warnings: list
) -> list[str]

def suggest_improvements(
    quality_level: QualityLevel,
    computation_mode: ComputationMode,
    n_days_data: int,
    calibrated_params: CalibratedParameters
) -> list[str]
```

#### `report_builder.py`

```python
def generate_html_report(
    annual_results: AnnualResults,
    calibrated_params: CalibratedParameters,
    user_inputs: UserInputs,
    suggestions: list[str]
) -> str

def save_html_report(html: str, filepath: str)
```

### 13.2 Konfigurace

#### `config.py`

```python
def get_api_key() -> Optional[str]
def set_api_key(api_key: str)

def get_last_location() -> Optional[str]
def set_last_location(location: str)

def save_user_inputs(inputs_dict: dict)
def load_user_inputs() -> Optional[dict]
```

---

## 14. KONFIGURACE

### 14.1 √ölo≈æi≈°tƒõ

**Adres√°≈ô:** `storage/`

**Soubory:**
- `token_store.json` - API kl√≠ƒçe a konfigurace
- `user_inputs.json` - Posledn√≠ u≈æivatelsk√© vstupy

**Form√°t token_store.json:**
```json
{
  "weather_api_key": "YOUR_API_KEY",
  "last_location": "Praha"
}
```

### 14.2 Environment promƒõnn√©

```bash
# Pro ADVANCED re≈æim - poƒçet vl√°ken
PENB_ADVANCED_THREADS=4  # Default: cpu_count - 1
```

### 14.3 Fyzik√°ln√≠ konstanty

```python
# rc_model.py
RHO_AIR = 1.2        # kg/m¬≥
CP_AIR = 1005        # J/(kg¬∑K)

# V√Ωchoz√≠ parametry
internal_gains = 3.0  # W/m¬≤
solar_aperture = 0.02 # pro byty
```

### 14.4 API limity

**WeatherAPI.com free tier:**
- Historie: 7 dn√≠ zpƒõtnƒõ
- P≈ôedpovƒõƒè: 3 dny dop≈ôedu
- 1 000 000 vol√°n√≠/mƒõs√≠c

**Placen√Ω tarif:**
- Historie: neomezen√°
- P≈ôedpovƒõƒè: 14 dn√≠

---

## 15. LIMITACE A OMEZEN√ç

### 15.1 Metodologick√° omezen√≠

‚ùå **NEN√ç ofici√°ln√≠ PENB:**
- Chyb√≠ detailn√≠ geometrie (okna, orientace)
- Zjednodu≈°en√Ω model (1R1C m√≠sto multi-zone)
- Nepoƒç√≠t√° v≈°echny komponenty (vƒõtr√°n√≠, chlazen√≠)

‚ùå **Aproximace:**
- Typick√Ω rok = sinusoida (ne skuteƒçn√Ω TMY)
- Hranice t≈ô√≠d zjednodu≈°en√©
- Prim√°rn√≠ energie orientaƒçn√≠

‚ùå **Z√°vislost na kvalitƒõ dat:**
- Provozn√≠ data mohou b√Ωt ne√∫pln√°
- U≈æivatelsk√© chov√°n√≠ variabiln√≠
- Pr≈Ømƒõrn√© teploty odhad

### 15.2 Technick√° omezen√≠

‚ö†Ô∏è **WeatherAPI:**
- Free tier: max 7 dn√≠ zpƒõtnƒõ
- Syntetick√° data pro star≈°√≠ obdob√≠

‚ö†Ô∏è **V√Ωpoƒçetn√≠ v√Ωkon:**
- ADVANCED re≈æim pomal√Ω (minutes)
- Paralelizace pom√°h√°

‚ö†Ô∏è **P≈ôesnost:**
- RMSE typicky 0.5-2¬∞C
- MAPE typicky 5-20%

### 15.3 Doporuƒçen√≠ pro pou≈æit√≠

‚úÖ **Vhodn√© pro:**
- Orientaƒçn√≠ odhad p≈ôed zateplen√≠m
- Porovn√°n√≠ variant vyt√°pƒõn√≠
- Identifikace probl√©m≈Ø (velk√© ztr√°ty)
- V√Ωukov√© √∫ƒçely

‚ùå **Nevhodn√© pro:**
- √ö≈ôedn√≠ doklady
- Dotaƒçn√≠ ≈ô√≠zen√≠
- Pr√°vnƒõ z√°vazn√© dokumenty
- Certifikace budov

### 15.4 Cesty k zlep≈°en√≠

**Vy≈°≈°√≠ priorita:**
1. Skuteƒçn√° TMY data (PVGIS, Meteonorm)
2. Multi-zone model (v√≠ce m√≠stnost√≠)
3. Detailn√≠ geometrie vstup
4. Validace na re√°ln√Ωch PENB datech

**Ni≈æ≈°√≠ priorita:**
5. V√≠kendov√Ω re≈æim (jin√© teploty)
6. Sez√≥nn√≠ adaptace
7. Machine learning kalibrace
8. Offline re≈æim (cached weather)

---

## üìå Z√ÅVƒöR

Tato aplikace poskytuje **rychl√Ω a p≈ô√≠stupn√Ω zp≈Øsob** orientaƒçn√≠ho odhadu energetick√© n√°roƒçnosti bytu z provozn√≠ch dat. Pou≈æ√≠v√° fyzik√°lnƒõ zalo≈æen√Ω p≈ô√≠stup (RC model) s automatickou kalibrac√≠, co≈æ zaji≈°≈•uje lep≈°√≠ p≈ôesnost ne≈æ jednoduch√© line√°rn√≠ regrese.

**Kl√≠ƒçov√© v√Ωhody:**
- ‚úÖ Nevy≈æaduje detailn√≠ znalost konstrukc√≠
- ‚úÖ Funguje s bƒõ≈ænƒõ dostupn√Ωmi daty
- ‚úÖ Poskytuje srozumiteln√© v√Ωsledky
- ‚úÖ Hodnot√≠ spolehlivost v√Ωsledk≈Ø
- ‚úÖ Flexibiln√≠ nastaven√≠ (verze 1.1.0)

**Pro ofici√°ln√≠ PENB kontaktujte opr√°vnƒõnou osobu!**

---

**Datum vytvo≈ôen√≠ dokumentace:** 28. ≈ô√≠jna 2025  
**Verze aplikace:** 1.1.0  
**Status:** ‚úÖ Produkƒçn√≠

---

